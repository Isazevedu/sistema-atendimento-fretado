<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Sistema de Atendimento - Transporte Fretado</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root {
      --bg: #f8fafc; --card-bg: #ffffff; --border: #e2e8f0;
      --text-main: #1e293b; --text-muted: #64748b;
      --primary-blue: #2563eb; --success-green: #22c55e;
      --color-cartao: #2563eb; --color-linha: #16a34a;
      --color-endereco: #7c3aed; --color-reclamacao: #dc2626;
    }

    * { box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
    body { background-color: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; gap: 20px; }

    .card { background: var(--card-bg); width: 100%; max-width: 850px; border-radius: 8px; border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); padding: 24px; }
    .header-title { color: var(--primary-blue); font-size: 24px; font-weight: 700; margin: 0; }
    
    .menu-list { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
    .menu-button { background: white; border: 1px solid var(--border); border-radius: 8px; padding: 18px; display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: 0.2s; gap: 8px; }
    .menu-button span { font-size: 14px; font-weight: 600; color: var(--text-main); }
    
    .menu-button.active.blue { border: 2.5px solid var(--color-cartao); background: #eff6ff; }
    .menu-button.active.green { border: 2.5px solid var(--color-linha); background: #f0fdf4; }
    .menu-button.active.purple { border: 2.5px solid var(--color-endereco); background: #faf5ff; }
    .menu-button.active.red { border: 2.5px solid var(--color-reclamacao); background: #fef2f2; }

    .form-section { display: none; margin-top: 20px; border-top: 1px solid var(--border); padding-top: 24px; }
    .form-header { display: flex; align-items: center; gap: 10px; font-size: 18px; font-weight: 700; margin-bottom: 20px; }
    
    .sub-section-title { grid-column: span 2; font-size: 14px; font-weight: 700; color: var(--primary-blue); margin: 15px 0 5px 0; padding-bottom: 5px; border-bottom: 1px dashed var(--border); display: flex; align-items: center; gap: 5px; }

    .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .full-width { grid-column: span 2; }

    .input-group { margin-bottom: 10px; }
    .input-group label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 6px; }
    .required { color: #ef4444; margin-left: 2px; }
    
    input, select, textarea { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; background: #fcfcfc; }
    .radio-group { display: flex; gap: 15px; margin-top: 5px; font-size: 14px; }
    .radio-group label { display: flex; align-items: center; gap: 5px; cursor: pointer; font-weight: normal; }
    .radio-group input { width: auto; }

    .save-btn { width: 100%; background: #2563eb; color: white; border: none; padding: 16px; border-radius: 8px; font-weight: 700; cursor: pointer; margin-top: 20px; }
    .export-btn { background-color: var(--success-green); color: white; border: none; padding: 10px 18px; border-radius: 6px; font-weight: 600; cursor: pointer; display: none; }
  </style>
</head>
<body>

  <div class="card">
    <h1 class="header-title">Sistema de Atendimento</h1>
    <p style="color:var(--text-muted); margin:0; font-size:14px;">Transporte Fretado • Registro de Atendimentos</p>

    <div class="menu-list">
      <div class="menu-button blue" onclick="showForm('cartao', this)"><i data-lucide="credit-card"></i><span>Troca de Cartão</span></div>
      <div class="menu-button green" onclick="showForm('linha', this)"><i data-lucide="repeat"></i><span>Mudança de Linha</span></div>
      <div class="menu-button purple" onclick="showForm('home', this)"><i data-lucide="home"></i><span>Mudança de Endereço</span></div>
      <div class="menu-button red" onclick="showForm('reclamacao', this)"><i data-lucide="alert-circle"></i><span>Reclamações</span></div>
    </div>

    <div id="form-container" class="form-section">
      <div class="form-header" id="dynamic-title"></div>
      <div id="fields-area"></div>
      <button class="save-btn" onclick="saveData()">Salvar Registro</button>
    </div>
  </div>

  <div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 style="margin:0;"><i data-lucide="file-text"></i> Registros Salvos (<span id="count">0</span>)</h3>
      <button class="export-btn" id="btnExport" onclick="exportToExcel()">Gerar Relatório</button>
    </div>
    <div id="records-list" style="margin-top:20px; text-align:center; color:var(--text-muted);">Nenhum registro salvo ainda.</div>
  </div>

  <script>
    let currentType = '';
    let savedRecords = JSON.parse(localStorage.getItem('atendimentos_fretado')) || [];
    
    lucide.createIcons();
    render();

    function showForm(type, el) {
      currentType = type;
      const container = document.getElementById('form-container');
      const fieldsArea = document.getElementById('fields-area');
      document.querySelectorAll('.menu-button').forEach(btn => btn.classList.remove('active'));
      el.classList.add('active');

      const common = `<div class="input-grid">
        <div class="input-group"><label>Work Day<span class="required">*</span></label><input type="text" id="wd" placeholder="Ex: WD123"></div>
        <div class="input-group"><label>Data do Atendimento<span class="required">*</span></label><input type="date" id="date" value="2025-12-23"></div>`;

      if(type === 'cartao') {
        document.getElementById('dynamic-title').innerHTML = `<i data-lucide="credit-card"></i> Troca de Cartão`;
        fieldsArea.innerHTML = common + `
          <div class="sub-section-title">Dados do Colaborador</div>
          <div class="input-group"><label>Cartão Novo<span class="required">*</span></label><input type="text" id="c_novo"></div>
          <div class="input-group"><label>RFID Novo<span class="required">*</span></label><input type="text" id="rfid_n"></div>
          <div class="input-group"><label>Cartão Anterior</label><input type="text" id="c_ant"></div>
          <div class="input-group"><label>RFID Anterior</label><input type="text" id="rfid_a"></div>
          <div class="input-group full-width"><label>Motivo da troca<span class="required">*</span></label>
            <select id="motivo_c"><option value="">Selecione...</option><option>Cartão quebrado</option><option>Cartão perdido</option><option>Cartão roubado</option><option>Mau funcionamento</option></select>
          </div>
          <div class="sub-section-title">Troca de Cartão de Terceirizado</div>
          <div class="input-group"><label>Nome Completo</label><input type="text" id="t_nome"></div>
          <div class="input-group"><label>CPF</label><input type="text" id="t_cpf" placeholder="000.000.000-00"></div>
          <div class="input-group"><label>Empresa</label><input type="text" id="t_empresa"></div>
          <div class="input-group"><label>Data</label><input type="date" id="t_data"></div>
          <div class="input-group"><label>Cartão Antigo RFID</label><input type="text" id="t_rfid_ant"></div>
          <div class="input-group"><label>Novo Cartão RFID</label><input type="text" id="t_rfid_nov"></div>
          <div class="input-group full-width"><label>Motivo da troca (Terceiro)</label>
            <select id="t_motivo"><option value="">Selecione...</option><option>Cartão quebrado</option><option>Cartão perdido</option><option>Cartão roubado</option><option>Mau funcionamento</option></select>
          </div>
        </div>`;
      } else if(type === 'linha') {
        document.getElementById('dynamic-title').innerHTML = `<i data-lucide="repeat"></i> Mudança de Linha`;
        fieldsArea.innerHTML = common + `
          <div class="input-group"><label>Linha Atual<span class="required">*</span></label><input type="text" id="l_atual" placeholder="Ex: Linha A - Centro"></div>
          <div class="input-group"><label>Linha Nova<span class="required">*</span></label><input type="text" id="l_nova" placeholder="Ex: Linha B - Zona Sul"></div>
          <div class="input-group full-width"><label>Motivo da Mudança<span class="required">*</span></label>
            <select id="motivo_l"><option value="">Selecione...</option><option>Solicitado por e-mail</option><option>Solicitado pelo colaborador</option><option>Mudança de endereço</option><option>Horário incompatível</option></select>
          </div>
          <div class="input-group full-width">
            <label>O endereço permanece o mesmo?<span class="required">*</span></label>
            <div class="radio-group">
                <label><input type="radio" name="same_addr" value="Sim" checked> Sim, mesmo endereço</label>
                <label><input type="radio" name="same_addr" value="Não"> Não, endereço mudou</label>
            </div>
          </div>
          <div class="input-group full-width"><label>Endereço Atual (opcional)</label><input type="text" id="end_ref" placeholder="Rua, número, bairro, cidade (opcional)"></div></div>`;
      } else if(type === 'home') {
        document.getElementById('dynamic-title').innerHTML = `<i data-lucide="home"></i> Mudança de Endereço`;
        fieldsArea.innerHTML = common + `
          <div class="input-group full-width"><label>Linha Atual<span class="required">*</span></label><input type="text" id="l_atual_e" placeholder="Ex: Linha A - Centro"></div>
          <div class="input-group full-width"><label>Endereço Anterior<span class="required">*</span></label><input type="text" id="e_ant" placeholder="Rua, número, bairro, cidade"></div>
          <div class="input-group full-width"><label>Endereço Novo<span class="required">*</span></label><input type="text" id="e_nov" placeholder="Rua, número, bairro, cidade"></div>
          <div class="input-group full-width">
            <label>Houve mudança de linha? (opcional)</label>
            <div class="radio-group">
                <label><input type="radio" name="change_line" value="Não" checked> Não, permanece na mesma linha</label>
                <label><input type="radio" name="change_line" value="Sim"> Sim, mudou de linha</label>
            </div>
          </div>
          <div class="input-group full-width"><label>Observações (opcional)</label><textarea id="obs_e" placeholder="Informações adicionais sobre a mudança de endereço..."></textarea></div></div>`;
      } else if(type === 'reclamacao') {
        document.getElementById('dynamic-title').innerHTML = `<i data-lucide="alert-circle"></i> Reclamação`;
        fieldsArea.innerHTML = common + `
          <div class="input-group full-width"><label>Linha<span class="required">*</span></label><input type="text" id="l_rec"></div>
          <div class="input-group full-width"><label>Tipo de Reclamação<span class="required">*</span></label>
            <select id="t_rec"><option value="">Selecione...</option><option>Atraso</option><option>Motorista</option><option>Limpeza</option><option>Outros</option></select>
          </div>
          <div class="input-group full-width"><label>Descrição Detalhada<span class="required">*</span></label><textarea id="desc_rec"></textarea></div></div>`;
      }
      container.style.display = 'block';
      lucide.createIcons();
    }

    function saveData() {
      const wd = document.getElementById('wd').value;
      if(!wd) return alert("Preencha o Work Day!");
      
      const date = document.getElementById('date').value.split('-').reverse().join('/');
      let dataObj = { id: Date.now(), type: currentType, wd, date, details: {} };

      if(currentType === 'cartao') {
        dataObj.details = { "Tipo": "TROCA DE CARTÃO", "Novo": document.getElementById('c_novo').value, "Motivo": document.getElementById('motivo_c').value, "Terceiro": document.getElementById('t_nome').value || "N/A" };
      } else if(currentType === 'linha') {
        dataObj.details = { "Tipo": "MUDANÇA LINHA", "De": document.getElementById('l_atual').value, "Para": document.getElementById('l_nova').value, "Endereço": document.querySelector('input[name="same_addr"]:checked').value === "Sim" ? "Permanece o mesmo" : "Mudou" };
      } else if(currentType === 'home') {
        dataObj.details = { "Tipo": "MUDANÇA ENDEREÇO", "Linha": document.getElementById('l_atual_e').value, "Novo End": document.getElementById('e_nov').value };
      } else {
        dataObj.details = { "Tipo": "RECLAMAÇÃO", "Linha": document.getElementById('l_rec').value, "Descrição": document.getElementById('desc_rec').value };
      }

      savedRecords.unshift(dataObj);
      localStorage.setItem('atendimentos_fretado', JSON.stringify(savedRecords));
      render();
    }

    function render() {
      const list = document.getElementById('records-list');
      document.getElementById('count').innerText = savedRecords.length;
      document.getElementById('btnExport').style.display = savedRecords.length ? 'block' : 'none';
      if(!savedRecords.length) { list.innerHTML = "Nenhum registro salvo ainda."; return; }
      list.innerHTML = savedRecords.map(r => `<div style="border:1px solid #e2e8f0; padding:10px; margin-top:10px; border-radius:8px; text-align:left;"><strong>${r.details.Tipo}</strong> - WD: ${r.wd} - ${r.date}</div>`).join('');
    }

    function exportToExcel() {
      let csv = "Tipo,WD,Data\n" + savedRecords.map(r => `${r.details.Tipo},${r.wd},${r.date}`).join("\n");
      const blob = new Blob(["\ufeff", csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "relatorio.csv";
      link.click();
    }
  </script>
</body>
</html>
