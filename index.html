<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Sistema de Atendimento - Registro Completo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root {
      --bg: #f8fafc; --card-bg: #ffffff; --border: #e2e8f0;
      --text-main: #1e293b; --text-muted: #64748b;
      --primary-blue: #2563eb; --success-green: #22c55e; --danger-red: #ef4444;
      --color-cartao: #2563eb; --color-linha: #16a34a;
      --color-endereco: #7c3aed; --color-reclamacao: #dc2626;
    }

    * { box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
    body { background-color: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; gap: 20px; }

    .card { background: var(--card-bg); width: 100%; max-width: 850px; border-radius: 8px; border: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); padding: 24px; }
    .header-title { color: var(--primary-blue); font-size: 24px; font-weight: 700; margin: 0; }
    
    .menu-list { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
    .menu-button { background: white; border: 1px solid var(--border); border-radius: 8px; padding: 18px; display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: 0.2s; gap: 8px; }
    .menu-button span { font-size: 14px; font-weight: 600; color: var(--text-main); }
    
    .icon-cartao { color: var(--color-cartao); }
    .icon-linha { color: var(--color-linha); }
    .icon-endereco { color: var(--color-endereco); }
    .icon-reclamacao { color: var(--color-reclamacao); }

    .menu-button.active.blue { border: 2.5px solid var(--color-cartao); background: #eff6ff; }
    .menu-button.active.green { border: 2.5px solid var(--color-linha); background: #f0fdf4; }
    .menu-button.active.purple { border: 2.5px solid var(--color-endereco); background: #faf5ff; }
    .menu-button.active.red { border: 2.5px solid var(--color-reclamacao); background: #fef2f2; }

    .form-section { display: none; margin-top: 20px; border-top: 1px solid var(--border); padding-top: 24px; }
    .form-header { display: flex; align-items: center; gap: 10px; font-size: 18px; font-weight: 700; margin-bottom: 20px; }
    
    .sub-section-title { grid-column: span 2; font-size: 14px; font-weight: 700; color: var(--primary-blue); margin: 15px 0 5px 0; padding-bottom: 5px; border-bottom: 1px dashed var(--border); display: flex; align-items: center; gap: 5px; }

    .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .full-width { grid-column: span 2; }

    .input-group { margin-bottom: 10px; }
    .input-group label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 6px; }
    .required { color: var(--danger-red); margin-left: 2px; }
    
    input, select, textarea { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; background: #fcfcfc; }
    textarea { min-height: 80px; resize: vertical; }

    .save-btn { width: 100%; background: linear-gradient(to bottom, #3b82f6, #2563eb); color: white; border: none; padding: 16px; border-radius: 8px; font-weight: 700; cursor: pointer; margin-top: 20px; }

    .record-card { border: 1px solid var(--border); border-radius: 8px; padding: 16px; margin-top: 12px; position: relative; text-align: left; background: #fff; border-left: 5px solid #cbd5e1; }
    .record-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; border-bottom: 1px solid #f1f5f9; padding-bottom: 8px; }
    .record-data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 13px; color: var(--text-main); }
    .data-item { margin-bottom: 4px; }
    .data-label { color: var(--text-muted); font-weight: 600; margin-right: 4px; }
    .delete-btn { color: var(--danger-red); cursor: pointer; border: none; background: none; }
    
    .export-btn { background-color: var(--success-green); color: white; border: none; padding: 10px 18px; border-radius: 6px; font-weight: 600; cursor: pointer; display: none; align-items: center; gap: 8px; }
  </style>
</head>
<body>

  <div class="card">
    <h1 class="header-title">Sistema de Atendimento</h1>
    <p style="color:var(--text-muted); margin:0; font-size:14px;">Transporte Fretado • Registro de Atendimentos</p>

    <div class="menu-list">
      <div class="menu-button blue" onclick="showForm('cartao', this)"><i data-lucide="credit-card" class="icon-cartao"></i><span>Troca de Cartão</span></div>
      <div class="menu-button green" onclick="showForm('linha', this)"><i data-lucide="repeat" class="icon-linha"></i><span>Mudança de Linha</span></div>
      <div class="menu-button purple" onclick="showForm('home', this)"><i data-lucide="home" class="icon-endereco"></i><span>Mudança de Endereço</span></div>
      <div class="menu-button red" onclick="showForm('reclamacao', this)"><i data-lucide="alert-circle" class="icon-reclamacao"></i><span>Reclamações</span></div>
    </div>

    <div id="form-container" class="form-section">
      <div class="form-header" id="dynamic-title"></div>
      <div id="fields-area"></div>
      <button class="save-btn" onclick="saveData()">Salvar Registro</button>
    </div>
  </div>

  <div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <h3 style="margin:0;"><i data-lucide="file-text"></i> Registros Salvos (<span id="count">0</span>)</h3>
      <button class="export-btn" id="btnExport" onclick="exportToExcel()"><i data-lucide="download"></i> Gerar Relatório Excel</button>
    </div>
    <div id="records-list" style="margin-top:20px; text-align:center; color:var(--text-muted);">Nenhum registro salvo ainda.</div>
  </div>

  <script>
    let currentType = '';
    let savedRecords = JSON.parse(localStorage.getItem('atendimentos_fretado')) || [];
    
    lucide.createIcons();
    render();

    function showForm(type, el) {
      currentType = type;
      const container = document.getElementById('form-container');
      const titleArea = document.getElementById('dynamic-title');
      const fieldsArea = document.getElementById('fields-area');
      document.querySelectorAll('.menu-button').forEach(btn => btn.classList.remove('active'));
      el.classList.add('active');

      const common = `<div class="input-grid">
        <div class="input-group"><label>Work Day<span class="required">*</span></label><input type="text" id="wd" placeholder="Ex: WD123"></div>
        <div class="input-group"><label>Data do Atendimento<span class="required">*</span></label><input type="date" id="date" value="2025-12-23"></div>`;

      if(type === 'cartao') {
        titleArea.innerHTML = `<i data-lucide="credit-card" class="icon-cartao"></i> Troca de Cartão`;
        fieldsArea.innerHTML = common + `
          <div class="sub-section-title"><i data-lucide="user"></i> Dados do Colaborador</div>
          <div class="input-group"><label>Cartão Novo<span class="required">*</span></label><input type="text" id="c_novo"></div>
          <div class="input-group"><label>RFID Novo<span class="required">*</span></label><input type="text" id="rfid_n"></div>
          <div class="input-group"><label>Cartão Anterior</label><input type="text" id="c_ant"></div>
          <div class="input-group"><label>RFID Anterior</label><input type="text" id="rfid_a"></div>
          <div class="input-group full-width"><label>Motivo da troca<span class="required">*</span></label>
            <select id="motivo_c"><option value="">Selecione...</option><option>Cartão quebrado</option><option>Cartão perdido</option><option>Cartão roubado</option><option>Mau funcionamento</option></select>
          </div>
          
          <div class="sub-section-title"><i data-lucide="users"></i> Se for Terceiro (Preencher abaixo)</div>
          <div class="input-group"><label>Nome Completo</label><input type="text" id="t_nome"></div>
          <div class="input-group"><label>CPF</label><input type="text" id="t_cpf" placeholder="000.000.000-00"></div>
          <div class="input-group"><label>Empresa</label><input type="text" id="t_empresa"></div>
          <div class="input-group"><label>Data Troca Terceiro</label><input type="date" id="t_data"></div>
          <div class="input-group"><label>Cartão Antigo (Terc.)</label><input type="text" id="t_c_ant"></div>
          <div class="input-group"><label>RFID Antigo (Terc.)</label><input type="text" id="t_rfid_ant"></div>
          <div class="input-group"><label>Novo Cartão (Terc.)</label><input type="text" id="t_c_nov"></div>
          <div class="input-group"><label>Novo RFID (Terc.)</label><input type="text" id="t_rfid_nov"></div>
          <div class="input-group full-width"><label>Motivo da troca (Terceiro)</label>
            <select id="t_motivo"><option value="">Selecione...</option><option>Cartão quebrado</option><option>Cartão perdido</option><option>Cartão roubado</option><option>Mau funcionamento</option></select>
          </div>
        </div>`;
      } else if(type === 'linha') {
        titleArea.innerHTML = `<i data-lucide="repeat" class="icon-linha"></i> Mudança de Linha`;
        fieldsArea.innerHTML = common + `
          <div class="input-group"><label>Linha Atual<span class="required">*</span></label><input type="text" id="l_atual"></div>
          <div class="input-group"><label>Linha Nova<span class="required">*</span></label><input type="text" id="l_nova"></div>
          <div class="input-group full-width"><label>Motivo<span class="required">*</span></label><select id="motivo_l"><option value="">Selecione...</option><option>Solicitado por e-mail</option><option>Mudança de endereço</option></select></div>
          <div class="input-group full-width"><label>Ref. Endereço</label><input type="text" id="end_ref"></div></div>`;
      } else if(type === 'home') {
        titleArea.innerHTML = `<i data-lucide="home" class="icon-endereco"></i> Mudança de Endereço`;
        fieldsArea.innerHTML = common + `
          <div class="input-group full-width"><label>Linha Atual<span class="required">*</span></label><input type="text" id="l_atual_e"></div>
          <div class="input-group full-width"><label>Endereço Anterior<span class="required">*</span></label><input type="text" id="e_ant"></div>
          <div class="input-group full-width"><label>Endereço Novo<span class="required">*</span></label><input type="text" id="e_nov"></div>
          <div class="input-group full-width"><label>Observações</label><textarea id="obs_e"></textarea></div></div>`;
      } else if(type === 'reclamacao') {
        titleArea.innerHTML = `<i data-lucide="alert-circle" class="icon-reclamacao"></i> Reclamações`;
        fieldsArea.innerHTML = common + `
          <div class="input-group full-width"><label>Linha<span class="required">*</span></label><input type="text" id="l_rec"></div>
          <div class="input-group full-width"><label>Tipo de Ocorrência<span class="required">*</span></label>
            <select id="t_rec">
                <option value="">Selecione...</option>
                <option>Atraso da linha</option>
                <option>Comportamento do motorista</option>
                <option>Solicitação de novo ponto</option>
                <option>Problemas com o ponto de embarque e desembarque</option>
                <option>Outros...</option>
            </select>
          </div>
          <div class="input-group full-width"><label>Descrição Detalhada<span class="required">*</span></label><textarea id="desc_rec"></textarea></div></div>`;
      }
      container.style.display = 'block';
      lucide.createIcons();
    }

    function saveData() {
      const wd = document.getElementById('wd').value;
      if(!wd) return alert("Preencha o Work Day!");

      const date = document.getElementById('date').value.split('-').reverse().join('/');
      let dataObj = { id: Date.now(), type: currentType, wd, date, details: {} };

      if(currentType === 'cartao') {
        dataObj.details = { 
            "Tipo": "TROCA DE CARTÃO", 
            "C. Novo": document.getElementById('c_novo').value, 
            "RFID N.": document.getElementById('rfid_n').value, 
            "Motivo": document.getElementById('motivo_c').value,
            "---TERCEIRO---": document.getElementById('t_nome').value ? "SIM" : "",
            "T. Nome": document.getElementById('t_nome').value,
            "T. CPF": document.getElementById('t_cpf').value,
            "T. Empresa": document.getElementById('t_empresa').value,
            "T. Novo Cartão": document.getElementById('t_c_nov').value,
            "T. Motivo": document.getElementById('t_motivo').value
        };
      } else if(currentType === 'linha') {
        dataObj.details = { "Tipo": "MUDANÇA LINHA", "Linha Atual": document.getElementById('l_atual').value, "Linha Nova": document.getElementById('l_nova').value, "Motivo": document.getElementById('motivo_l').value };
      } else if(currentType === 'home') {
        dataObj.details = { "Tipo": "MUDANÇA ENDEREÇO", "Linha": document.getElementById('l_atual_e').value, "End. Novo": document.getElementById('e_nov').value };
      } else {
        dataObj.details = { "Tipo": "RECLAMAÇÃO", "Linha": document.getElementById('l_rec').value, "Tipo Erro": document.getElementById('t_rec').value, "Descrição": document.getElementById('desc_rec').value };
      }

      savedRecords.unshift(dataObj);
      localStorage.setItem('atendimentos_fretado', JSON.stringify(savedRecords));
      render();
    }

    function render() {
      const list = document.getElementById('records-list');
      document.getElementById('count').innerText = savedRecords.length;
      document.getElementById('btnExport').style.display = savedRecords.length ? 'flex' : 'none';
      if(!savedRecords.length) { list.innerHTML = "Nenhum registro salvo ainda."; return; }

      list.innerHTML = savedRecords.map(r => `
        <div class="record-card">
          <div class="record-header">
            <span><strong>${r.details["Tipo"]}</strong> • WD: ${r.wd} • ${r.date}</span>
            <button class="delete-btn" onclick="del(${r.id})"><i data-lucide="trash-2" size="18"></i></button>
          </div>
          <div class="record-data-grid">
            ${Object.entries(r.details).map(([key, val]) => val ? `<div class="data-item"><span class="data-label">${key}:</span> ${val}</div>` : '').join('')}
          </div>
        </div>`).join('');
      lucide.createIcons();
    }

    function del(id) { 
        savedRecords = savedRecords.filter(r => r.id !== id); 
        localStorage.setItem('atendimentos_fretado', JSON.stringify(savedRecords));
        render(); 
    }

    function exportToExcel() {
      let csv = "Tipo,WD,Data,Detalhes\n";
      savedRecords.forEach(r => {
        let detailsStr = Object.entries(r.details).map(([k,v]) => `${k}: ${v}`).join(' | ');
        csv += `"${r.details["Tipo"]}","${r.wd}","${r.date}","${detailsStr}"\n`;
      });
      const blob = new Blob(["\ufeff", csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "relatorio_atendimento.csv";
      link.click();
    }
  </script>
</body>
</html>
